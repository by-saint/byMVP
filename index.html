<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"><title>A Carregar...</title><meta name="viewport" content="width=device-width,initial-scale=1"><style>body{background-color:#121212;color:#fff;font-family:Arial,sans-serif;display:flex;align-items:center;justify-content:center;height:100vh;margin:0}</style>
</head>
<body>
  <p>A verificar a sua sessão...</p>
<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
  const SUPABASE_URL = 'https://mrebmxvxlajqfgcpsvfv.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1yZWJteHZ4bGFqcWZnY3BzdmZ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3Nzk0MjMsImV4cCI6MjA3NTM1NTQyM30.2oxAHxiYph6gvuIwunoypCJexHQbLExULpwqU0UWdDM';
  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  async function checkSessionAndRedirect() {
    const { data: { session } } = await supabase.auth.getSession();
    if (!session) {
      window.location.replace('login.html');
      return;
    }
    const { data: profile } = await supabase.from('profiles').select('niche').eq('id', session.user.id).single();
    if (profile) {
      if (profile.niche === 'saude') window.location.replace('membros-saude.html');
      // Adicione mais `else if` aqui para futuros nichos
      else { 
        alert('Nicho não reconhecido. A terminar sessão.');
        await supabase.auth.signOut();
        window.location.replace('login.html');
      }
    } else {
      alert('Perfil não encontrado. A terminar sessão.');
      await supabase.auth.signOut();
      window.location.replace('login.html');
    }
  }
  checkSessionAndRedirect();
</script>
</body>
</html>
